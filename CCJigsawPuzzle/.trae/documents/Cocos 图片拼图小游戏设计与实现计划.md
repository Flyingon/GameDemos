## 产品目标
- 参考 Jigsaw Explorer 的体验，做一个“上传图片→打散拼图→完成拼图”的跨端 2D 小游戏（优先 Web，兼容原生）。
- 首版以“规则网格拼图”为核心，后续加入“仿真拼图齿轮形状、旋转、托盘、提示、进度保存”等增强玩法。

## 核心玩法
- 上传图片：从相册或文件选择，生成拼图素材。
- 难度选择：行×列（如 6×4、10×8），是否允许旋转。
- 打散与随机化：将碎片随机分布到画布/托盘，可选择“只展示边角碎片”。
- 拖拽与吸附：拖动碎片靠近目标位置，达到阈值自动吸附并锁定；支持连片移动（已吸附的碎片组成组）。
- 预览与幽灵图：小窗预览完整图；可开启半透明幽灵图作为拼图参考。
- 计时与完成：计时器与完成动画/特效，成绩保存。

## 趣味增强（迭代项）
- 拼图齿形：不规则“凸-凹”边，通过矢量路径或模板遮罩形成真实拼图轮廓。
- 旋转玩法：碎片随机旋转 0/90/180/270°，双击或按钮旋转；吸附需角度正确。
- 托盘与分类：托盘收纳、只看边角、按颜色/区域聚类建议。
- 小帮手与道具：高亮目标位置、单片定位、临时磁力增强、逐渐显影提示。
- 放大与多选：画布缩放/平移，多选成组移动，提升后期效率。
- 动效与音效：吸附“咔哒”声、完成烟花、渐入渐出，提升愉悦感。
- 进度与分享：本地进度自动保存；导出拼图配置/进度 JSON，分享复盘。

## 技术实现（Cocos Creator 3.8.x）
- 场景结构：`Main` 主场景包含 `Board`（拼图区域）、`Tray`（托盘）、`UI`（控制面板、预览、小帮手）。
- 图片加载：Web 端使用 `<input type=file>` + `URL.createObjectURL` → `cc.assetManager.loadRemote`；原生端可后续接相册/拍照插件。
- 规则网格切片（首版）：
  - 依据行列生成碎片矩形；每片 `Node` 下挂 `Sprite`，`SpriteFrame` 使用同一纹理的 `rect` 子区域。
  - 目标位置 = 网格坐标；随机散落初始位置在 `Tray` 或画布四周。
- 不规则齿形切片（迭代）：
  - 生成每片的矢量路径（含凸/凹“齿”），`Mask(type: GRAPHICS)` 裁剪显示；子节点 `Sprite` 载整图并偏移对齐遮罩。
  - 可选进一步用 `Graphics` 绘制边缘描边、或自定义材质模拟纸质阴影。
- 拖拽与吸附：
  - 触摸/鼠标事件处理；移动时提升 `zIndex`；落点与目标点距离/角度在阈值内则吸附锁定。
  - 片与片吸附：检测相邻目标关系，匹配边界且相对位移/角度满足时合并为组。
- 旋转与组移动：碎片/组节点维护角度；吸附时角度校验；组移动时统一变换。
- 提示与幽灵图：幽灵图为整图半透明 `Sprite` 对齐 `Board`；目标轮廓高亮用 `Graphics` 绘制。
- 性能优化：
  - 统一纹理、尽量共用材质减少 draw call；遮罩/Graphics 数量控制；只在交互时更新。
  - 大图按需缩放到画布合理分辨率，避免超大纹理导致内存压力。
- 进度存储：使用 `localStorage` 保存图片哈希、碎片状态（位置、角度、组归属）。

## 关键模块设计
- `PuzzleController`：场景总控，难度与参数管理、切片生成、状态保存/恢复、完成判定。
- `ImageLoader`：处理用户选择图片，生成纹理与基础信息（宽高、缩放比例）。
- `GridSlicer` / `JigsawSlicer`：规则网格/不规则齿形的几何生成与节点创建。
- `PieceNode`（Prefab）：单片节点（`Sprite` + 可选 `Mask` + 交互脚本），含目标信息与当前状态。
- `SnapManager`：距离/角度阈值判断、片间吸附与组管理。
- `TrayController` / `UIController`：托盘布局、筛选按钮、预览/提示开关、计时器。
- `SaveService`：本地持久化（序列化/反序列化）。

## 数据与状态
- 配置：行列、旋转开关、吸附阈值、随机种子、是否仅边角。
- 每片：`id`、`row/col`、目标 `position/rotation`、当前 `position/rotation`、`groupId`、是否锁定。
- 进度：图片标识、时间、完成片数、组结构。

## 平台与上传
- Web（首发）：文件上传、触摸与鼠标统一输入层；适配移动端 UI。
- 原生（迭代）：相册/拍照插件；存档落盘；分辨率与内存管控。

## 里程碑
- 阶段 A（1–2 天）：搭主场景与 UI，完成图片上传与规则网格切片，拖拽与吸附，完成判定。
- 阶段 B（1–2 天）：托盘、预览、计时、进度保存；边角筛选；基础动效与音效。
- 阶段 C（2–3 天）：不规则齿形切片与轮廓、旋转玩法、组移动、提示道具。
- 阶段 D（1–2 天）：性能与 UX 打磨、分享/导出、更多趣味内容。

## 验收标准
- 任意图片可被加载为拼图，规则网格切片稳定且吸附顺滑。
- 50–200 片范围内操作流畅；完成后有明确反馈与成绩记录。
- 进度可断点续玩；常见移动设备上交互与显示适配良好。

## 初始项目现状与改动
- 当前仓库为 Cocos Creator 3.8.7 的空项目（无 `assets/` 场景与脚本）。
- 预计新增：`assets/scenes/Main.scene`、`assets/scripts` 下的控制器/切片/节点脚本与 Prefab、基础 UI 资源。

## 请求确认
- 是否按上述阶段推进？若确认，我将初始化主场景与首版规则网格拼图并交付可运行原型，再逐步迭代增强。